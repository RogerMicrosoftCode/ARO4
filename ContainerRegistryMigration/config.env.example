#!/bin/bash
#######################################################
# ACR Image Replication - Configuration File
# 
# INSTRUCCIONES:
# 1. Copiar este archivo a config.env
# 2. Modificar las variables según tu entorno
# 3. NUNCA commitear config.env con credenciales reales
#######################################################

#======================================================
# REGISTRY ORIGEN
#======================================================

# Tipo de registry: docker.io | ghcr.io | quay.io | mcr.microsoft.com | custom
SOURCE_REGISTRY="docker.io"

# Namespace/organización/usuario del origen
# Ejemplos: 
#   - Docker Hub: "library" (oficial), "bitnami", "nginx"
#   - GHCR: "owner/repo" o "organization"
#   - Quay: "organization"
SOURCE_NAMESPACE="library"

# Archivo con lista de imágenes (una por línea, formato: image:tag)
# Si está vacío, intentará descubrir automáticamente
SOURCE_IMAGES_FILE="images_to_replicate.txt"

# Autenticación del origen (dejar vacío si es público)
# NOTA: Para Docker Hub, usar token de acceso, no password
# export SOURCE_USERNAME="tu-usuario"
# export SOURCE_PASSWORD="tu-token"

#======================================================
# AZURE CONTAINER REGISTRY (DESTINO)
#======================================================

# Nombre del ACR (sin .azurecr.io)
DEST_ACR_NAME="miacrprivado"

# Login server completo
DEST_ACR_LOGIN_SERVER="${DEST_ACR_NAME}.azurecr.io"

# Subscription y Resource Group (opcional, para az acr import)
AZ_SUBSCRIPTION_ID=""
AZ_RESOURCE_GROUP=""

# Prefijo opcional para repositorios en destino
# Ejemplo: si DEST_PREFIX="external", nginx:latest -> external/nginx:latest
DEST_PREFIX=""

#======================================================
# OPCIONES DE EJECUCIÓN
#======================================================

# Modo simulación (true = no copia, solo muestra)
DRY_RUN="false"

# Número máximo de copias en paralelo
MAX_PARALLEL=4

# Número de reintentos por imagen
MAX_RETRIES=3

# Backoff inicial en segundos (se duplica en cada reintento)
BACKOFF_INITIAL=5

# Timeout por imagen en segundos
COPY_TIMEOUT=600

# Método de copia preferido: acr-import | skopeo | oras | docker
COPY_METHOD="acr-import"

# Copiar todas las arquitecturas (multi-arch)
COPY_ALL_PLATFORMS="true"

# Omitir si el digest ya existe en destino
SKIP_EXISTING="true"

# Verificar digest después de copiar
VERIFY_DIGEST="true"

#======================================================
# LOGS Y REPORTES
#======================================================

# Directorio de reportes
REPORTS_DIR="./reports"

# Nivel de log: DEBUG | INFO | WARN | ERROR
LOG_LEVEL="INFO"

# Formato de reporte: md | csv | both
REPORT_FORMAT="both"

#======================================================
# RATE LIMITING
#======================================================

# Delay entre requests al registry origen (segundos)
REQUEST_DELAY=1

# Máximo de requests por minuto (0 = sin límite)
MAX_REQUESTS_PER_MINUTE=100

#======================================================
# FILTROS (opcional)
#======================================================

# Filtrar por patrón de nombre de imagen (regex)
# Ejemplo: "nginx|redis|postgres"
FILTER_IMAGES=""

# Filtrar por patrón de tag (regex)
# Ejemplo: "^v[0-9]+|latest|stable"
FILTER_TAGS=""

# Excluir tags que coincidan con este patrón
EXCLUDE_TAGS="alpha|beta|rc|dev|test"

# Número máximo de tags por imagen (0 = todos)
MAX_TAGS_PER_IMAGE=0
